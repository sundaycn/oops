<!doctype html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0,user-scalable=no" />
<meta name="format-detection" content="telephone=no" />
<meta name="format-detection" content="email=no" />
<meta name="format-detection" content="address=no;">
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="default" />
<title>请假登记</title>
<link rel="stylesheet" type="text/css" href="../css/global.css"/>
<script type="text/javascript" src="../scripts/jquery-1.8.2.min.js"></script>
<script type="text/javascript" src="../scripts/jquery.autosize.js"></script>
<script type="text/javascript" src="../scripts/app.js"></script>
<script type="text/javascript">
var isAPP = (window.APP && window.APP.login) ? true : false, // 是否通过手机访问
	userName = isAPP ? window.APP.getUserName() : "",    // 获得登录账户的用户名
	pageUrl = window.location.href.toString(),
	data = {
		"filter_GED_workday": app.getParam(pageUrl, "filter_GED_workday") || "",
		"filter_LED_workday": app.getParam(pageUrl, "filter_LED_workday") || "",
		"page.pageNo": app.getParam(pageUrl, "page.pageNo") || 1,
		"page.pageSize": app.getParam(pageUrl, "page.pageNo") || 10,
	},
	setResult = function (rs, handler) {
		if (isAPP) {
			window.APP.hideLoading();
		}
		if (!rs.success && rs.errorCode == "001") {
			if (isAPP) {
				window.APP.login();
			} else {
				alert(rs.message);
			}
		} else {
			if (typeof handler == "function") {
				handler(rs);
			}
		}
	};
	
function load () {
	app.loadData(app.basePath + "TattendanceLeaveType/tattendanceleavetype!listAjax.action", "", function (rs) {
		setResult(rs, function (rs) {
			if (rs.success) {
				var html = '';
				$(rs.message.result).each(function () {
					html += '<option value="'+ this.id +'">'+ this.name +'</option>';
				});
				$("#leaveType").html(html);
			}
		});
	});
}



function doSubmit () {
	if (app.formValidateEmpty()) {
		return false;
	}
	if (isAPP) {
		window.APP.showMask("正在保存...");
	}
	app.loadData(app.basePath + "TattendanceLeave/tattendanceleave!saveObjAjax.action", {
		startdate: $("#startDate .value").val(),
		starttime: $("#startTime .value").val(),
		enddate: $("#endDate .value").val(),
		endtime: $("#endtTime .value").val(),
		leaveDays:$("#leaveDays").val(),
		leaveType:$("#leaveType").val(),
		reason:$("#reason").val()
	}, function (rs) {
		setResult(rs, function (rs) {
			if (isAPP) {
				window.APP.hideMask();
			}
			if (rs.success) {
				doProcess("TattendanceLeave/tattendanceleave", rs.message.business_code, rs.message.id);
			} else {
				alert(rs.message);
			}
		});
	});
	
	return false;
}

$(function () {
	$(".eoa-form textarea").focus(function () {
		if ($(this).val() == "请输入请假理由。。。") {
			$(this).val("");
		}
	}).bind("keydown keyup",function(){
	   $(this).autosize();
	}).autosize();
	// 添加必填标识
	//$(".required").append('<span class="icon icon-star">*</span>');
	// 添加弹出框选择标识
	$(".select, .picker").append('<span class="icon icon-triangle"></span>');
	load();
	$(".btn").click(doSubmit);
});
</script>
</head>
<body id="attend">
<div id="pageindex" class="theme-default">
	<div class="eoa-form">
		<ul>
			<li>
				<span class="label">请假类型：</span>
				<span class="input select required">
					<select id="leaveType">
						<option >事假</option>
						<option>年休假</option>
					</select>
				</span>
			</li>
			<li>
				<span class="label">请假天数：</span>
				<span class="input number required">
					<input type="number" id="leaveDays" class="txt" value="" />
				</span>
			</li>
			<li class="">
				<span class="label">开始日期：</span>
				<span class="input picker required">
					<span class="datepicker" id="startDate" onclick="window.APP.getDate('#startDate')">
						<span class="txt">请选择日期</span>
						<input type="hidden" class="value" value="" />
					</span>
				</span>
			</li>
			<li>
				<span class="label">开始时间：</span>
				<span class="input picker required">
					<span class="timepicker" id="startTime" onclick="window.APP.getTime('#startTime')">
						<span class="txt">请选择时间</span>
						<input type="hidden" class="value" value="" />
					</span>
				</span>
			</li>
			<li>
				<span class="label">结束日期：</span>
				<span class="input picker required">
					<span class="datepicker" id="endDate" onclick="window.APP.getDate('#endDate')">
						<span class="txt">请选择日期</span>
						<input type="hidden" class="value" value="" />
					</span>
				</span>
			</li>
			<li>
				<span class="label">结束时间：</span>
				<span class="input picker required">
					<span class="timepicker" id="endtTime" onclick="window.APP.getTime('#endtTime')">
						<span class="txt">请选择时间</span>
						<input type="hidden" class="value" value="" />
					</span>
				</span>
			</li>
			<li>
				<span class="label">请假理由：</span>
				<span class="input textarea required">
					<textarea id="reason" ></textarea>
				</span>
			</li>
		</ul>
		
		<p><a href="javascript:void(0)" class="btn">保存并送审</a></p>
	</div>
</div>
</body>
</html>